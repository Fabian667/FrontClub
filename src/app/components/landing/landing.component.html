<div class="landing">
  <header class="site-header">
    <div class="container header-content">
      <div class="brand">
        <a routerLink="/" class="brand-link">
          <span class="brand-plus" aria-hidden="true">+</span>
          <span class="brand-verde">Verde</span>
        </a>
      </div>
      <!-- Botón menú hamburguesa -->
      <button class="menu-toggle" type="button"
              aria-label="Abrir menú"
              aria-controls="primary-nav"
              [attr.aria-expanded]="menuOpen()"
              (click)="toggleMenu()">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>
      <nav id="primary-nav" class="nav-links" [class.open]="menuOpen()">
        <a href="#noticias" *ngIf="noticias().length > 0" (click)="closeMenu()">Noticias</a>
        <a href="#actividades" (click)="closeMenu()">Actividades</a>
        <a href="#instalaciones" (click)="closeMenu()">Instalaciones</a>
        <a href="#eventos" (click)="closeMenu()">Eventos</a>
        <a href="#contacto" (click)="closeMenu()">Contacto</a>
        <a *ngIf="!isLoggedIn()" routerLink="/admin/login" class="login-btn" (click)="closeMenu()">Login</a>
        <button *ngIf="isLoggedIn()" (click)="logout(); closeMenu()" class="login-btn">Salir</button>
      </nav>
    </div>
  </header>
  <!-- Hero Section -->
  <section class="hero" [ngStyle]="{ 'background-image': backgroundStyle() }">
    <div class="hero-content">
      <h1 class="brand-title">
        <span class="brand-plus" aria-hidden="true">+</span>
        <span class="brand-verde">Verde</span>
      </h1>
      <p>Descubre nuestras actividades, instalaciones, eventos y noticias</p>
      <!-- Botón de administrar eliminado -->
      <div>
        <button class="cta-btn alt small" type="button" (click)="openReservasModal()">Reservas</button>
      </div>
    </div>
  </section>

  <!-- Modal de Reservas -->
  <div class="modal-backdrop" *ngIf="reservasModalOpen()" (click)="closeReservasModal()">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="reservasModalTitle" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 id="reservasModalTitle">Reservas de {{ clubName() || 'nuestro club' }}</h2>
        <button class="modal-close" (click)="closeReservasModal()" aria-label="Cerrar">×</button>
      </div>
      <div class="modal-body">
        <!-- Pregunta si es socio -->
        <div class="socio-question" *ngIf="!mostrarSolicitud()">
          <p><strong>¿Eres socio?</strong></p>
          <div class="actions">
            <button class="cta-btn" routerLink="/admin/login" (click)="closeReservasModal()" type="button">Sí, soy socio</button>
            <button class="cta-btn alt" (click)="openSolicitudForm()">No, solicitar reserva</button>
            <button class="cta-btn ghost" type="button" (click)="closeReservasModal()">Cancelar</button>
          </div>
        </div>

        <!-- Formulario de solicitud para no socios -->
        <form *ngIf="mostrarSolicitud()" #solForm="ngForm" (ngSubmit)="sendSolicitudWhatsApp(solForm)" class="solicitud-form">
          <h3>Solicitud de reserva (no socios)</h3>
          <div class="form-row">
            <label for="solNombre">Nombre</label>
            <input id="solNombre" name="nombre" [(ngModel)]="solicitud.nombre" required />
          </div>
          <div class="form-row">
            <label for="solTelefono">Teléfono</label>
            <input id="solTelefono" name="telefono" [(ngModel)]="solicitud.telefono" required />
          </div>
          <div class="form-row">
            <label for="solEmail">Email</label>
            <input id="solEmail" name="email" type="email" [(ngModel)]="solicitud.email" />
          </div>
          <div class="form-row">
            <label for="solInstalacion">Instalación</label>
            <select id="solInstalacion" name="instalacion" [(ngModel)]="solicitud.instalacionId">
              <option [ngValue]="null">Seleccionar...</option>
              <option *ngFor="let i of instalaciones()" [ngValue]="i.id">{{ i.nombre }}</option>
            </select>
          </div>
          <div class="form-row grid-2">
            <div>
              <label for="solFecha">Fecha</label>
              <input id="solFecha" name="fecha" type="date" [(ngModel)]="solicitud.fecha" />
            </div>
            <div>
              <label for="solInicio">Hora inicio</label>
              <input id="solInicio" name="horaInicio" type="time" [(ngModel)]="solicitud.horaInicio" />
            </div>
            <div>
              <label for="solFin">Hora fin</label>
              <input id="solFin" name="horaFin" type="time" [(ngModel)]="solicitud.horaFin" />
            </div>
          </div>
          <div class="form-row">
            <label for="solMotivo">Motivo</label>
            <textarea id="solMotivo" name="motivo" rows="3" [(ngModel)]="solicitud.motivo"></textarea>
          </div>
          <div class="form-actions">
            <button class="cta-btn" type="submit">Enviar por WhatsApp</button>
          </div>
        </form>

        <div class="grid" *ngIf="!mostrarSolicitud()">
          <div class="card" *ngFor="let r of reservas()">
            <div class="card-content">
              <h3>{{ getInstalacionNombre(r.instalacion_id) }}</h3>
              <div class="details">
                <span>Fecha: {{ r.fecha_reserva }}</span>
                <span *ngIf="r.hora_inicio">Inicio: {{ r.hora_inicio }}</span>
                <span *ngIf="r.hora_fin">Fin: {{ r.hora_fin }}</span>
                <span *ngIf="r.cantidad_personas">Personas: {{ r.cantidad_personas }}</span>
                <span *ngIf="r.estado">Estado: {{ r.estado }}</span>
              </div>
              <p *ngIf="r.motivo">Motivo: {{ r.motivo }}</p>
              <p *ngIf="r.observaciones">Observaciones: {{ r.observaciones }}</p>
            </div>
          </div>
        </div>
        <p *ngIf="!mostrarSolicitud() && reservas().length === 0" class="empty-msg">No hay reservas para mostrar.</p>
      </div>
      <div class="modal-footer">
        <button class="cta-btn ghost large" type="button" (click)="closeReservasModal()">Salir</button>
      </div>
    </div>
  </div>

  <!-- Noticias Section -->
  <section class="section" id="noticias" *ngIf="noticias().length > 0">
    <div class="container">
      <h2>Noticias</h2>
      <div class="grid">
        <div class="card" *ngFor="let noticia of noticias()">
          <div class="card-image" *ngIf="noticia.imagenUrl">
            <img [src]="noticia.imagenUrl" alt="Imagen noticia" appFallbackImage />
          </div>
          <div class="card-content">
            <h3>{{ noticia.titulo }}</h3>
            <p *ngIf="noticia.descripcion">{{ noticia.descripcion }}</p>
            <div class="details" *ngIf="noticia.fecha">
              <span>{{ noticia.fecha }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Actividades Section -->
  <section class="section" id="actividades">
    <div class="container">
      <h2>Nuestras Actividades</h2>
      <div class="grid">
        <div class="card" *ngFor="let actividad of actividades()">
          <div class="card-content">
            <h3>{{ actividad.nombre }}</h3>
            <p>{{ actividad.descripcion }}</p>
            <div class="details" *ngIf="actividad.diaSemana || actividad.horaInicio">
              <span *ngIf="actividad.diaSemana">{{ actividad.diaSemana }}</span>
              <span *ngIf="actividad.horaInicio">{{ actividad.horaInicio }} - {{ actividad.horaFin }}</span>
              <span *ngIf="actividad.precioHora !== null && actividad.precioHora !== undefined" class="precio">${{ actividad.precioHora }}/hora</span>
            </div>
          </div>
        </div>
      </div>
      <p *ngIf="actividades().length === 0" class="empty-msg">No hay actividades disponibles por el momento.</p>
    </div>
  </section>

  <!-- Instalaciones Section -->
  <section class="section alt" id="instalaciones">
    <div class="container">
      <h2>Nuestras Instalaciones</h2>
      <div class="grid">
        <div class="card" *ngFor="let instalacion of instalaciones()">
          <!-- Imagen arriba: mostrar solo si existe en el admin -->
          <div class="card-image" *ngIf="instalacion.foto || instalacion.imagen">
            <img [src]="instalacion.foto || instalacion.imagen" alt="Imagen instalación" />
          </div>

          <div class="card-content">
            <h3>{{ instalacion.nombre }}</h3>
            <p>{{ instalacion.descripcion }}</p>
            <div class="details" *ngIf="instalacion.capacidad">
              <span>Capacidad: {{ instalacion.capacidad }} personas</span>
              <span *ngIf="instalacion.precioHora !== null && instalacion.precioHora !== undefined" class="precio">${{ instalacion.precioHora }}/hora</span>
            </div>
            <a *ngIf="instalacion.url" [href]="instalacion.url" target="_blank" rel="noopener noreferrer" class="instalacion-link" title="Abrir sitio relacionado">
              <span class="link-text">Visitar sitio</span>
              <span aria-hidden="true" class="link-arrow">→</span>
            </a>
          </div>
        </div>
      </div>
      <p *ngIf="instalaciones().length === 0" class="empty-msg">No hay instalaciones disponibles o no se pudieron cargar.</p>
    </div>
  </section>

  <!-- Eventos Section -->
  <section class="section" id="eventos">
    <div class="container">
      <h2>Próximos Eventos</h2>
      <div class="grid">
        <div class="card" *ngFor="let evento of eventos()">
          <div class="card-image" *ngIf="evento.imagen">
            <img [src]="evento.imagen" alt="Imagen evento" appFallbackImage />
          </div>
          <div class="card-content">
            <h3>{{ evento.nombre }}</h3>
            <p>{{ evento.descripcion }}</p>
            <div class="details" *ngIf="evento.fecha || evento.lugar">
              <span *ngIf="evento.fecha">{{ evento.fecha }}</span>
              <span *ngIf="evento.horaInicio">{{ evento.horaInicio }} - {{ evento.horaFin }}</span>
              <span *ngIf="evento.lugar">{{ evento.lugar }}</span>
              <span *ngIf="evento.costo !== null && evento.costo !== undefined" class="precio">${{ evento.costo }}</span>
            </div>
          </div>
        </div>
      </div>
      <p *ngIf="eventos().length === 0" class="empty-msg">No hay eventos programados o no se pudieron cargar.</p>
    </div>
  </section>


  <!-- Contact Section -->
  <section id="contacto" class="contact-section">
    <div class="container">
      <h2>Contacto</h2>
      <div class="contact-grid">
        <!-- Contact Form -->
        <div class="contact-form">
          <h3>Envíanos un mensaje</h3>
          <form #contactForm="ngForm" (ngSubmit)="onContactSubmit(contactForm)">
            <div class="form-group">
              <label for="name">Nombre</label>
              <input type="text" id="name" name="name" ngModel required>
            </div>
            <div class="form-group">
              <label for="message">Mensaje</label>
              <textarea id="message" name="message" rows="4" ngModel required></textarea>
            </div>
            <button type="submit" class="submit-btn" [disabled]="!contactForm.valid">Enviar</button>
          </form>
        </div>

        <!-- Contact Info -->
        <div class="contact-info">
          <h3>Información de contacto</h3>
          <!-- Eliminado: no mostrar contraseñas en la UI -->
          <div class="info-item" *ngIf="contactInfo().address">
            <strong>Dirección:</strong>
            <p>{{ contactInfo().address }}</p>
          </div>
          <div class="info-item" *ngIf="contactInfo().phone">
            <strong>Teléfono:</strong>
            <p>{{ contactInfo().phone }}</p>
          </div>
          <div class="info-item" *ngIf="contactInfo().email">
            <strong>Email:</strong>
            <p>{{ contactInfo().email }}</p>
          </div>
          
          <!-- Social Media -->
          <div class="social-links" *ngIf="contactInfo().facebook || contactInfo().instagram || contactInfo().whatsapp">
            <h4>Síguenos</h4>
            <div class="social-buttons">
              <a *ngIf="contactInfo().facebook" [href]="contactInfo().facebook" target="_blank" rel="noopener" class="social-btn facebook" aria-label="Facebook">
                <img src="icons/facebook.svg" alt="Facebook" class="social-icon" />
                <span class="sr-only">Facebook</span>
              </a>
              <a *ngIf="contactInfo().instagram" [href]="contactInfo().instagram" target="_blank" rel="noopener" class="social-btn instagram" aria-label="Instagram">
                <img src="icons/instagram.svg" alt="Instagram" class="social-icon" />
                <span class="sr-only">Instagram</span>
              </a>
              <a *ngIf="contactInfo().whatsapp" [href]="getWhatsappUrl(contactInfo().whatsapp)" target="_blank" rel="noopener" class="social-btn whatsapp" aria-label="WhatsApp">
                <img src="icons/whatsapp.svg" alt="WhatsApp" class="social-icon" />
                <span class="sr-only">WhatsApp</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Ubicación (mapa) fuera del bloque de Información de contacto -->
  <section class="map-section" *ngIf="contactInfo().mapsUrl">
    <div class="container">
      <div class="map-container">
        <iframe 
          [src]="contactInfo().mapsUrl" 
          width="100%" 
          height="300" 
          style="border:0;" 
          allowfullscreen="" 
          loading="lazy" 
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>
        &copy; 2025 
        <span class="brand-plus" aria-hidden="true">+</span>
        <span class="brand-verde">Verde</span>. Todos los derechos reservados.
      </p>
    </div>
  </footer>
</div>